<phone:PhoneApplicationPage
    x:Class="SimpleTasks.Views.EditTaskPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:phone="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone"
    xmlns:shell="clr-namespace:Microsoft.Phone.Shell;assembly=Microsoft.Phone"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:toolkit="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone.Controls.Toolkit"
    xmlns:controls="clr-namespace:SimpleTasks.Controls"
    FontFamily="{StaticResource PhoneFontFamilyNormal}"
    FontSize="{StaticResource PhoneFontSizeNormal}"
    Foreground="{StaticResource PhoneForegroundBrush}"
    SupportedOrientations="PortraitOrLandscape" Orientation="Portrait"
    mc:Ignorable="d"
    shell:SystemTray.IsVisible="True"
    shell:SystemTray.BackgroundColor="{StaticResource PhoneChromeColor}"
    toolkit:TiltEffect.IsTiltEnabled="True" BackKeyPress="PhoneApplicationPage_BackKeyPress">

    <toolkit:TransitionService.NavigationInTransition>
        <toolkit:NavigationInTransition>
            <toolkit:NavigationInTransition.Backward>
                <toolkit:SlideTransition Mode="SlideDownFadeIn" />
            </toolkit:NavigationInTransition.Backward>
            <toolkit:NavigationInTransition.Forward>
                <toolkit:SlideTransition Mode="SlideUpFadeIn" />
            </toolkit:NavigationInTransition.Forward>
        </toolkit:NavigationInTransition>
    </toolkit:TransitionService.NavigationInTransition>
    <toolkit:TransitionService.NavigationOutTransition>
        <toolkit:NavigationOutTransition>
            <toolkit:NavigationOutTransition.Backward>
                <toolkit:SlideTransition Mode="SlideDownFadeOut" />
            </toolkit:NavigationOutTransition.Backward>
            <toolkit:NavigationOutTransition.Forward>
                <toolkit:SlideTransition Mode="SlideUpFadeOut" />
            </toolkit:NavigationOutTransition.Forward>
        </toolkit:NavigationOutTransition>
    </toolkit:TransitionService.NavigationOutTransition>


    <phone:PhoneApplicationPage.Resources>
        <!--Region TitleTextBlock-->
        <SolidColorBrush x:Key="TitleCaretBrush" Color="{StaticResource PhoneAccentColor}" />

        <SolidColorBrush x:Key="TitleBorderBrush" Color="{StaticResource PhoneSubtleColor}" Opacity="0.6" />

        <Style x:Key="TitleTextBoxStyle" TargetType="toolkit:PhoneTextBox">
            <Setter Property="FontFamily" Value="{StaticResource PhoneFontFamilyNormal}"/>
            <Setter Property="FontSize" Value="{StaticResource PhoneFontSizeMediumLarge}"/>
            <Setter Property="Background" Value="{StaticResource PhoneSubtleBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource PhoneForegroundBrush}"/>
            <Setter Property="CaretBrush" Value="{StaticResource TitleCaretBrush}"/>
            <Setter Property="BorderThickness" Value="0,0,0,5" />
            <Setter Property="SelectionBackground" Value="{StaticResource PhoneAccentBrush}"/>
            <Setter Property="SelectionForeground" Value="{StaticResource PhoneTextBoxSelectionForegroundBrush}"/>
            <Setter Property="Padding" Value="{StaticResource PhoneBorderThickness}"/>
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="InputScope" Value="Text" />
            <Setter Property="HintStyle">
                <Setter.Value>
                    <Style TargetType="ContentControl">
                        <Setter Property="Foreground" Value="{StaticResource PhoneSubtleBrush}" />
                    </Style>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="toolkit:PhoneTextBox">
                        <Grid x:Name="RootGrid" Background="Transparent">
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup x:Name="CommonStates">
                                    <VisualState x:Name="Normal"/>
                                    <VisualState x:Name="Disabled">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Visibility" Storyboard.TargetName="HintBorder">
                                                <DiscreteObjectKeyFrame KeyTime="0">
                                                    <DiscreteObjectKeyFrame.Value>
                                                        <Visibility>Collapsed</Visibility>
                                                    </DiscreteObjectKeyFrame.Value>
                                                </DiscreteObjectKeyFrame>
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Visibility" Storyboard.TargetName="TextBorder">
                                                <DiscreteObjectKeyFrame KeyTime="0">
                                                    <DiscreteObjectKeyFrame.Value>
                                                        <Visibility>Visible</Visibility>
                                                    </DiscreteObjectKeyFrame.Value>
                                                </DiscreteObjectKeyFrame>
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="BorderBrush" Storyboard.TargetName="TextBorder">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="Transparent"/>
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Margin" Storyboard.TargetName="TextBorder">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="0"/>
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="HorizontalAlignment" Storyboard.TargetName="Text">
                                                <DiscreteObjectKeyFrame KeyTime="0">
                                                    <DiscreteObjectKeyFrame.Value>
                                                        <HorizontalAlignment>Stretch</HorizontalAlignment>
                                                    </DiscreteObjectKeyFrame.Value>
                                                </DiscreteObjectKeyFrame>
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>
                                <VisualStateGroup x:Name="FocusStates">
                                    <VisualState x:Name="Focused">
                                        <Storyboard>
                                            <ColorAnimation Storyboard.TargetName="HintBorderBrush" 
                                                            Storyboard.TargetProperty="Color"
                                                            To="{StaticResource PhoneAccentColor}"
                                                            Duration="0:0:0.2"/>
                                            <DoubleAnimation Storyboard.TargetName="ContentElement" 
                                                             Storyboard.TargetProperty="Opacity"
                                                             To="1"
                                                             Duration="0:0:0.2"/>
                                            <DoubleAnimation Storyboard.TargetName="HintContent" 
                                                             Storyboard.TargetProperty="Opacity"
                                                             To="0"
                                                             Duration="0:0:0.2"/>
                                            <DoubleAnimation Storyboard.TargetName="HintBorder" 
                                                             Storyboard.TargetProperty="(Grid.Background).(SolidColorBrush.Opacity)"
                                                             To="0.265"
                                                             Duration="0:0:0.2"/>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="Unfocused">
                                        <Storyboard>
                                            <ColorAnimation Storyboard.TargetName="HintBorderBrush" 
                                                            Storyboard.TargetProperty="Color"
                                                            To="{x:Null}"
                                                            Duration="0:0:0.2"/>
                                            <DoubleAnimation Storyboard.TargetName="ContentElement" 
                                                             Storyboard.TargetProperty="Opacity"
                                                             To="0.75"
                                                             Duration="0:0:0.2"/>
                                            <DoubleAnimation Storyboard.TargetName="HintContent" 
                                                             Storyboard.TargetProperty="Opacity"
                                                             To="0.8"
                                                             Duration="0:0:0.2"/>
                                            <DoubleAnimation Storyboard.TargetName="HintBorder" 
                                                             Storyboard.TargetProperty="(Grid.Background).(SolidColorBrush.Opacity)"
                                                             To="0.175"
                                                             Duration="0:0:0.2"/>
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>
                                <VisualStateGroup x:Name="LengthIndicatorStates">
                                    <VisualState x:Name="LengthIndicatorVisible">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Visibility" Storyboard.TargetName="LengthIndicator">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0">
                                                    <DiscreteObjectKeyFrame.Value>
                                                        <Visibility>Visible</Visibility>
                                                    </DiscreteObjectKeyFrame.Value>
                                                </DiscreteObjectKeyFrame>
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Margin" Storyboard.TargetName="RootGrid">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0" Value="0, 0, 0, 27"/>
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Opacity" Storyboard.TargetName="LengthIndicator">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0" Value="0.6"/>
                                            </ObjectAnimationUsingKeyFrames>
                                            <DoubleAnimation Duration="0:0:0.350" To="32" Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)" Storyboard.TargetName="LengthIndicator">
                                                <DoubleAnimation.EasingFunction>
                                                    <ExponentialEase Exponent="6"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="LengthIndicatorHidden">
                                        <Storyboard>
                                            <DoubleAnimation Duration="0:0:0.350" To="0" Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)" Storyboard.TargetName="LengthIndicator">
                                                <DoubleAnimation.EasingFunction>
                                                    <ExponentialEase Exponent="6"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Margin" Storyboard.TargetName="RootGrid">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0" Value="0, 0, 0, 0"/>
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Opacity" Storyboard.TargetName="LengthIndicator">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0.350" Value="0"/>
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Visibility" Storyboard.TargetName="LengthIndicator">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0.350">
                                                    <DiscreteObjectKeyFrame.Value>
                                                        <Visibility>Collapsed</Visibility>
                                                    </DiscreteObjectKeyFrame.Value>
                                                </DiscreteObjectKeyFrame>
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>
                            <Border x:Name="LengthIndicatorBorder">
                                <TextBlock x:Name="LengthIndicator" Foreground="{StaticResource PhoneContrastBackgroundBrush}" FontSize="{StaticResource PhoneFontSizeNormal}" HorizontalAlignment="Right" Margin="{StaticResource PhoneMargin}" Opacity="0" TextAlignment="Right" VerticalAlignment="Bottom">
                                    <TextBlock.RenderTransform>
                                        <TranslateTransform/>
                                    </TextBlock.RenderTransform>
                                </TextBlock>
                            </Border>
                            <Border x:Name="HintBorder" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}" Margin="{StaticResource PhoneTouchTargetOverhang}">
                                <Border.BorderBrush>
                                    <SolidColorBrush x:Name="HintBorderBrush" Color="{StaticResource PhoneChromeColor}" />
                                </Border.BorderBrush>
                                <Grid>
                                    <ContentControl x:Name="HintContent" Opacity="0.8" Background="Transparent" Content="{TemplateBinding Hint}" HorizontalAlignment="Left" Margin="3,0,3,0" Style="{TemplateBinding HintStyle}" Visibility="{TemplateBinding ActualHintVisibility}" VerticalAlignment="Center"/>
                                    <ContentControl x:Name="ContentElement" Opacity="0.75" BorderThickness="0" HorizontalContentAlignment="Stretch" Margin="{StaticResource PhoneTextBoxInnerMargin}" Padding="{TemplateBinding Padding}" VerticalContentAlignment="Stretch"/>
                                </Grid>
                            </Border>
                            <Border x:Name="TextBorder" BorderBrush="{StaticResource PhoneDisabledBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="Transparent" Margin="{StaticResource PhoneTouchTargetOverhang}" Visibility="Collapsed">
                                <TextBox x:Name="Text" Foreground="{StaticResource PhoneDisabledBrush}" FontWeight="{TemplateBinding FontWeight}" FontStyle="{TemplateBinding FontStyle}" FontSize="{TemplateBinding FontSize}" FontFamily="{TemplateBinding FontFamily}" HorizontalAlignment="Left" SelectionForeground="{TemplateBinding SelectionForeground}" SelectionBackground="{TemplateBinding SelectionBackground}" TextAlignment="{TemplateBinding TextAlignment}" TextWrapping="{TemplateBinding TextWrapping}" Text="{TemplateBinding Text}"/>
                            </Border>
                            <Border x:Name="ActionIconBorder" Background="Transparent" HorizontalAlignment="Right" Height="72" VerticalAlignment="Bottom" Width="84">
                                <Image x:Name="ActionIcon" Height="26" Source="{TemplateBinding ActionIcon}" Width="26"/>
                            </Border>
                            <TextBlock x:Name="MeasurementTextBlock" FontWeight="{TemplateBinding FontWeight}" FontStyle="{TemplateBinding FontStyle}" FontStretch="{TemplateBinding FontStretch}" FontSize="{TemplateBinding FontSize}" FontFamily="{TemplateBinding FontFamily}" IsHitTestVisible="False" Margin="8" Opacity="0" TextAlignment="{TemplateBinding TextAlignment}" TextWrapping="{TemplateBinding TextWrapping}" Text="{TemplateBinding Text}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <!--EndRegion-->

        <!--Region DueDate-->

        <ControlTemplate x:Key="DueDateButtonTemplate">
            <Border x:Name="DueDateButtonBorder"
                    Style="{StaticResource ButtonBorderStyle}"
                    Background="{StaticResource PhoneSubtleBrush}">
                <VisualStateManager.VisualStateGroups>
                    <VisualStateGroup x:Name="CheckStates">
                        <VisualState x:Name="Checked">
                            <Storyboard>
                                <ColorAnimation Storyboard.TargetName="DueDateButtonBorder" 
                                                Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                                To="{StaticResource PhoneAccentColor}"
                                                Duration="0:0:0.4"/>
                            </Storyboard>
                        </VisualState>
                        <VisualState x:Name="Unchecked">
                            <Storyboard>
                                <ColorAnimation Storyboard.TargetName="DueDateButtonBorder" 
                                                Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                                To="{StaticResource PhoneSubtleColor}"
                                                Duration="0:0:0.4"/>
                            </Storyboard>
                        </VisualState>
                    </VisualStateGroup>
                </VisualStateManager.VisualStateGroups>
                <StackPanel Orientation="Horizontal">
                    <controls:Icon x:Name="CalendarIcon"
                                   Style="{StaticResource CalendarIconStyle}"
                                   Color="{StaticResource ButtonForegroundBrush}"/>
                    <TextBlock Text="{Binding LocalizedResources.DueDate, Source={StaticResource LocalizedStrings}}"
                               Style="{StaticResource ButtonTextBlockStyle}"/>
                </StackPanel>
            </Border>
        </ControlTemplate>

        <ControlTemplate x:Key="DueDatePickerTemplate">
            <Button x:Name="DateTimeButton"
                    Content="{TemplateBinding toolkit:DatePicker.ValueString}"
                    Height="{TemplateBinding Height}">
                <Button.Template>
                    <ControlTemplate>
                        <Border x:Name="Border"
                                Background="{StaticResource PhoneAccentBrush}"
                                Height="{TemplateBinding Height}">
                            <Border Background="#33000000"
                                    Padding="60,0,0,0">
                                <TextBlock Text="{TemplateBinding Button.Content}"
                                           FontSize="{StaticResource PhoneFontSizeMedium}"
                                           Style="{StaticResource ButtonTextBlockStyle}"/>
                            </Border>
                        </Border>
                    </ControlTemplate>
                </Button.Template>
            </Button>
        </ControlTemplate>

        <ControlTemplate x:Key="DueDatePresetPickerTemplate">
            <Border x:Name="Border"
                    Background="{StaticResource PhoneAccentBrush}"
                    Height="{TemplateBinding Height}">
                <Border Background="#7A000000">
                    <controls:Icon Style="{StaticResource DownArrowIconStyle}"
                                   Color="{StaticResource PhoneSubtleBrush}" 
                                   Width="50"
                                   Height="50"/>
                </Border>
            </Border>
        </ControlTemplate>

        <DataTemplate x:Key="DueDatePresetFullModeTemplate">
            <StackPanel Margin="0,0,0,5">
                <TextBlock Text="{Binding Key}"
                           Style="{StaticResource PhoneTextExtraLargeStyle}" />
                <TextBlock Text="{Binding Value, Converter={StaticResource DateToStringConverter}}"
                           Style="{StaticResource PhoneTextSmallStyle}"/>
            </StackPanel>
        </DataTemplate>

        <!--EndRegion-->

        <!--Region Priority-->

        <ControlTemplate x:Key="PriorityButtonTemplate">
            <Border Style="{StaticResource ButtonBorderStyle}">
                <VisualStateManager.VisualStateGroups>
                    <VisualStateGroup x:Name="CheckStates">
                        <VisualState x:Name="Checked">
                            <Storyboard>
                                <ColorAnimation Storyboard.TargetName="PriorityBorderBackgroundBrush" 
                                                Storyboard.TargetProperty="Color"
                                                To="{StaticResource PhoneAccentColor}"
                                                Duration="0:0:0.4"/>
                                <DoubleAnimation Storyboard.TargetName="HighPriorityGrid" 
                                                 Storyboard.TargetProperty="Opacity"
                                                 To="1"
                                                 Duration="0:0:0.4" />
                                <DoubleAnimation Storyboard.TargetName="NormalPriorityGrid" 
                                                 Storyboard.TargetProperty="Opacity"
                                                 To="0"
                                                 Duration="0:0:0.4" />
                                <DoubleAnimation Storyboard.TargetName="LowPriorityGrid" 
                                                 Storyboard.TargetProperty="Opacity"
                                                 To="0"
                                                 Duration="0:0:0.4" />
                            </Storyboard>
                        </VisualState>
                        <VisualState x:Name="Indeterminate">
                            <Storyboard>
                                <ColorAnimation Storyboard.TargetName="PriorityBorderBackgroundBrush" 
                                                Storyboard.TargetProperty="Color"
                                                To="{StaticResource PhoneSubtleColor}"
                                                Duration="0:0:0.4"/>
                                <DoubleAnimation Storyboard.TargetName="HighPriorityGrid" 
                                                 Storyboard.TargetProperty="Opacity"
                                                 To="0"
                                                 Duration="0:0:0.4" />
                                <DoubleAnimation Storyboard.TargetName="NormalPriorityGrid" 
                                                 Storyboard.TargetProperty="Opacity"
                                                 To="1"
                                                 Duration="0:0:0.4" />
                                <DoubleAnimation Storyboard.TargetName="LowPriorityGrid" 
                                                 Storyboard.TargetProperty="Opacity"
                                                 To="0"
                                                 Duration="0:0:0.4" />
                            </Storyboard>
                        </VisualState>
                        <VisualState x:Name="Unchecked">
                            <Storyboard>
                                <ColorAnimation Storyboard.TargetName="PriorityBorderBackgroundBrush" 
                                                Storyboard.TargetProperty="Color"
                                                To="{StaticResource PhoneSubtleColor}"
                                                Duration="0:0:0.4"/>
                                <DoubleAnimation Storyboard.TargetName="HighPriorityGrid" 
                                                 Storyboard.TargetProperty="Opacity"
                                                 To="0"
                                                 Duration="0:0:0.4" />
                                <DoubleAnimation Storyboard.TargetName="NormalPriorityGrid" 
                                                 Storyboard.TargetProperty="Opacity"
                                                 To="0"
                                                 Duration="0:0:0.4" />
                                <DoubleAnimation Storyboard.TargetName="LowPriorityGrid" 
                                                 Storyboard.TargetProperty="Opacity"
                                                 To="1"
                                                 Duration="0:0:0.4" />
                            </Storyboard>
                        </VisualState>
                    </VisualStateGroup>
                </VisualStateManager.VisualStateGroups>
                <Border.Background>
                    <SolidColorBrush x:Name="PriorityBorderBackgroundBrush"
                                     Color="{StaticResource PhoneSubtleColor}" />
                </Border.Background>
                <StackPanel Orientation="Horizontal">
                    <Grid>
                        <Grid x:Name="HighPriorityGrid" Opacity="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="60"/>
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>
                            <controls:Icon Style="{StaticResource HighPriorityIconStyle}"
                                           Color="{StaticResource ButtonForegroundBrush}"/>
                            <TextBlock Text="{Binding LocalizedResources.PriorityHigh, Source={StaticResource LocalizedStrings}}"
                                       Style="{StaticResource ButtonTextBlockStyle}"
                                       Grid.Column="1"/>
                        </Grid>
                        <Grid x:Name="NormalPriorityGrid" Opacity="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="60"/>
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="{Binding LocalizedResources.PriorityNormal, Source={StaticResource LocalizedStrings}}"
                                       Style="{StaticResource ButtonTextBlockStyle}"
                                       Grid.Column="1"/>
                        </Grid>
                        <Grid x:Name="LowPriorityGrid">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="60"/>
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>
                            <controls:Icon Style="{StaticResource LowPriorityIconStyle}"
                                           Color="{StaticResource ButtonForegroundBrush}"/>
                            <TextBlock Text="{Binding LocalizedResources.PriorityLow, Source={StaticResource LocalizedStrings}}"
                                       Style="{StaticResource ButtonTextBlockStyle}"
                                       Grid.Column="1"/>
                        </Grid>
                    </Grid>
                </StackPanel>
            </Border>
        </ControlTemplate>

        <!--EndRegion-->

        <!--Region Reminder-->

        <ControlTemplate x:Key="ReminderButtonTemplate">
            <Border Style="{StaticResource ButtonBorderStyle}">
                <VisualStateManager.VisualStateGroups>
                    <VisualStateGroup x:Name="CheckStates">
                        <VisualState x:Name="Checked">
                            <Storyboard>
                                <ColorAnimation Storyboard.TargetName="ReminderBorderBackgroundBrush" 
                                                Storyboard.TargetProperty="Color"
                                                To="{StaticResource PhoneAccentColor}"
                                                Duration="0:0:0.4"/>
                                <DoubleAnimation Storyboard.TargetName="DisabledReminderIcon" 
                                                 Storyboard.TargetProperty="Opacity"
                                                 To="0"
                                                 Duration="0:0:0.4" />
                                <DoubleAnimation Storyboard.TargetName="ReminderIcon" 
                                                 Storyboard.TargetProperty="Opacity"
                                                 To="1"
                                                 Duration="0:0:0.4" />
                            </Storyboard>
                        </VisualState>
                        <VisualState x:Name="Unchecked">
                            <Storyboard>
                                <ColorAnimation Storyboard.TargetName="ReminderBorderBackgroundBrush" 
                                                Storyboard.TargetProperty="Color"
                                                To="{StaticResource PhoneSubtleColor}"
                                                Duration="0:0:0.4"/>
                                <DoubleAnimation Storyboard.TargetName="DisabledReminderIcon" 
                                                 Storyboard.TargetProperty="Opacity"
                                                 To="1"
                                                 Duration="0:0:0.4" />
                                <DoubleAnimation Storyboard.TargetName="ReminderIcon" 
                                                 Storyboard.TargetProperty="Opacity"
                                                 To="0"
                                                 Duration="0:0:0.4" />
                            </Storyboard>
                        </VisualState>
                    </VisualStateGroup>
                </VisualStateManager.VisualStateGroups>
                <Border.Background>
                    <SolidColorBrush x:Name="ReminderBorderBackgroundBrush"
                                     Color="{StaticResource PhoneSubtleColor}" />
                </Border.Background>
                <StackPanel Orientation="Horizontal">
                    <Grid>
                        <controls:Icon x:Name="ReminderIcon"
                                       Style="{StaticResource ReminderIconStyle}"
                                       Color="{StaticResource ButtonForegroundBrush}"/>
                        <controls:Icon x:Name="DisabledReminderIcon"
                                       Style="{StaticResource DisabledReminderIconStyle}"
                                       Color="{StaticResource ButtonForegroundBrush}"/>
                    </Grid>
                    <TextBlock Text="{Binding LocalizedResources.Reminder, Source={StaticResource LocalizedStrings}}"
                               Style="{StaticResource ButtonTextBlockStyle}"/>
                </StackPanel>
            </Border>
        </ControlTemplate>

        <ControlTemplate x:Key="ReminderDatePickerTemplate">
            <Button x:Name="DateTimeButton"
                    Content="{TemplateBinding toolkit:DatePicker.ValueString}"
                    Height="{TemplateBinding Height}">
                <Button.Template>
                    <ControlTemplate>
                        <Border x:Name="Border"
                                Background="{StaticResource PhoneAccentBrush}"
                                Height="{TemplateBinding Height}">
                            <Grid Background="#33000000">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="60"/>
                                    <ColumnDefinition />
                                </Grid.ColumnDefinitions>
                                <controls:Icon x:Name="ReminderIcon"
                                               Grid.Column="0"
                                               Offset="7,11"
                                               Opacity="0.35"
                                               Style="{StaticResource CalendarIconStyle}"
                                               Color="{StaticResource ButtonForegroundBrush}" 
                                               RenderTransformOrigin="0.5,0.5" 
                                               VerticalAlignment="Center">
                                    <controls:Icon.RenderTransform>
                                        <CompositeTransform ScaleX="0.75" ScaleY="0.75"/>
                                    </controls:Icon.RenderTransform>
                                </controls:Icon>
                                <TextBlock Text="{TemplateBinding Button.Content}"
                                           Grid.Column="1"
                                           FontSize="{StaticResource PhoneFontSizeMedium}"
                                           Style="{StaticResource ButtonTextBlockStyle}"/>
                            </Grid>
                        </Border>
                    </ControlTemplate>
                </Button.Template>
            </Button>
        </ControlTemplate>

        <ControlTemplate x:Key="ReminderTimePickerTemplate">
            <Button x:Name="DateTimeButton"
                    Content="{TemplateBinding toolkit:TimePicker.ValueString}"
                    Height="{TemplateBinding Height}">
                <Button.Template>
                    <ControlTemplate>
                        <Border x:Name="Border"
                                Background="{StaticResource PhoneAccentBrush}"
                                Height="{TemplateBinding Height}">
                            <Grid Background="#47000000">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="60"/>
                                    <ColumnDefinition />
                                </Grid.ColumnDefinitions>
                                <controls:Icon x:Name="ReminderIcon"
                                               Grid.Column="0"
                                               Offset="7,12"
                                               Opacity="0.35"
                                               Style="{StaticResource ClockIconStyle}"
                                               Color="{StaticResource ButtonForegroundBrush}" 
                                               RenderTransformOrigin="0.5,0.5"
                                               VerticalAlignment="Center">
                                    <controls:Icon.RenderTransform>
                                        <CompositeTransform ScaleX="0.75" ScaleY="0.75"/>
                                    </controls:Icon.RenderTransform>
                                </controls:Icon>
                                <TextBlock Text="{TemplateBinding Button.Content}"
                                           Grid.Column="1"
                                           FontSize="{StaticResource PhoneFontSizeMedium}"
                                           Style="{StaticResource ButtonTextBlockStyle}"/>
                            </Grid>
                        </Border>
                    </ControlTemplate>
                </Button.Template>
            </Button>
        </ControlTemplate>

        <!--EndRegion-->
    </phone:PhoneApplicationPage.Resources>


    <Grid x:Name="LayoutRoot"
          Background="{StaticResource ApplicationBackgroundBrush}">

        <ScrollViewer>
            <!--ContentPanel - place additional content here-->
            <Grid x:Name="ContentPanel" Margin="12,40,12,0">
                <StackPanel>
                    <!--Nadpis-->
                    <toolkit:PhoneTextBox x:Name="TitleTextBox"
                                          Text="{Binding CurrentTask.Title, Mode=TwoWay}"
                                          Hint="&#8230;&#xe104;"
                                          Margin="20,0"
                                          KeyDown="PhoneTextBox_KeyDown" 
                                          Style="{StaticResource TitleTextBoxStyle}" 
                                          FontFamily="Segoe UI Symbol" 
                                          GotFocus="TitleTextBox_GotFocus" 
                                          LostFocus="TitleTextBox_LostFocus"
                                          AcceptsReturn="True">
                        <toolkit:PhoneTextBox.Resources>
                            <Storyboard x:Name="TitleTextBoxNoTextStoryboard">
                                <DoubleAnimation Storyboard.TargetName="TitleTextBox"
                                                 Storyboard.TargetProperty="Opacity"
                                                 From="1.0"
                                                 To="0.35"
                                                 AutoReverse="True"
                                                 RepeatBehavior="Forever"
                                                 BeginTime="0:0:0.5"
                                                 Duration="0:0:0.5" >
                                    <DoubleAnimation.EasingFunction>
                                        <PowerEase EasingMode="EaseInOut"/>
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                            </Storyboard>
                        </toolkit:PhoneTextBox.Resources>
                    </toolkit:PhoneTextBox>

                    <!--Výběr termínu-->
                    <StackPanel Orientation="Vertical"
                                Margin="50,20,50,0">
                        <ToggleButton x:Name="DueDateToggleButton"
                                      Template="{StaticResource DueDateButtonTemplate}"
                                      IsChecked="{Binding CurrentTask.HasDueDate}"
                                      Checked="DueToggleButton_Checked" 
                                      Unchecked="DueToggleButton_Unchecked"/>
                        <Grid x:Name="DueDateGrid"
                              Height="{Binding CurrentTask.HasDueDate, 
                                       Converter={StaticResource BooleanToNumberConverter},
                                       ConverterParameter=50,
                                       FallbackValue=50,
                                       Mode=OneTime}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition />
                                <ColumnDefinition Width="50"/>
                            </Grid.ColumnDefinitions>
                            <Grid.Resources>
                                <Storyboard x:Name="DueDateGridShow">
                                    <DoubleAnimation Storyboard.TargetName="DueDateGrid"
                                                     Storyboard.TargetProperty="Height"
                                                     To="50"
                                                     Duration="0:0:0.4">
                                        <DoubleAnimation.EasingFunction>
                                            <BackEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                </Storyboard>
                                <Storyboard x:Name="DueDateGridHide">
                                    <DoubleAnimation Storyboard.TargetName="DueDateGrid"
                                                     Storyboard.TargetProperty="Height"
                                                     To="0"
                                                     Duration="0:0:0.3">
                                        <DoubleAnimation.EasingFunction>
                                            <BackEase EasingMode="EaseIn"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                </Storyboard>
                            </Grid.Resources>

                            <toolkit:DatePicker x:Name="DueDatePicker"
                                                Grid.Column="0"
                                                Value="{Binding CurrentTask.DueDate, Mode=TwoWay}"
                                                ValueStringFormat="{Binding Source={StaticResource DateTimeExtensions}, Path=Format}"
                                                Template="{StaticResource DueDatePickerTemplate}"/>

                            <toolkit:ListPicker x:Name="DueDatePresetPicker"
                                                Grid.Column="1"
                                                Template="{StaticResource DueDatePresetPickerTemplate}"
                                                Margin="0"
                                                ItemsSource="{Binding PresetDueDateList}"
                                                ExpansionMode="FullScreenOnly"
                                                FullModeHeader="{Binding LocalizedResources.ChooseDueDate, Source={StaticResource LocalizedStrings}}"
                                                FullModeItemTemplate="{StaticResource DueDatePresetFullModeTemplate}"/>
                        </Grid>
                    </StackPanel>

                    <!--Priorita-->
                    <ToggleButton Margin="50,20,50,0"
                                  IsThreeState="True"
                                  IsChecked="{Binding CurrentTask.Priority, Mode=TwoWay,
                                              Converter={StaticResource TaskPriorityToBooleanConverter}}"
                                  Template="{StaticResource PriorityButtonTemplate}"/>

                    <!--Připomenutí-->
                    <StackPanel Orientation="Vertical"
                                Margin="50,20,50,0">
                        <ToggleButton x:Name="ReminderToggleButton"
                                      Template="{StaticResource ReminderButtonTemplate}"
                                      IsChecked="{Binding CurrentTask.HasReminder}"
                                      Checked="ReminderToggleButton_Checked" 
                                      Unchecked="ReminderToggleButton_Unchecked"/>

                        <Grid x:Name="ReminderGrid"
                              Height="{Binding CurrentTask.HasReminder, 
                                               Converter={StaticResource BooleanToNumberConverter},
                                               ConverterParameter=100,
                                               FallbackValue=100,
                                               Mode=OneTime}"
                              Visibility="{Binding CurrentTask.HasReminder, Mode=OneTime, 
                                           Converter={StaticResource BooleanToVisibilityConverter}}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="1*"/>
                                <RowDefinition Height="1*"/>
                            </Grid.RowDefinitions>
                            <Grid.Resources>
                                <Storyboard x:Name="ReminderGridShow">
                                    <DoubleAnimation Storyboard.TargetName="ReminderGrid"
                                                     Storyboard.TargetProperty="Height"
                                                     To="100"
                                                     Duration="0:0:0.45">
                                        <DoubleAnimation.EasingFunction>
                                            <BackEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                </Storyboard>
                                <Storyboard x:Name="ReminderGridHide">
                                    <DoubleAnimation Storyboard.TargetName="ReminderGrid"
                                                     Storyboard.TargetProperty="Height"
                                                     To="0"
                                                     Duration="0:0:0.35">
                                        <DoubleAnimation.EasingFunction>
                                            <BackEase EasingMode="EaseIn"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                </Storyboard>
                            </Grid.Resources>

                            <!--Datum-->
                            <toolkit:DatePicker Name="ReminderDatePicker"
                                                Grid.Row="0"
                                                Value="{Binding CurrentTask.ReminderDate, Mode=TwoWay}"
                                                ValueStringFormat="{Binding Source={StaticResource DateTimeExtensions}, Path=Format}"
                                                Template="{StaticResource ReminderDatePickerTemplate}"/>

                            <!--Čas-->
                            <toolkit:TimePicker Name="ReminderTimePicker"
                                                Grid.Row="1"
                                                Value="{Binding CurrentTask.ReminderDate, Mode=TwoWay}"
                                                Template="{StaticResource ReminderTimePickerTemplate}" />
                        </Grid>

                    </StackPanel>
                </StackPanel>
            </Grid>
        </ScrollViewer>
    </Grid>

</phone:PhoneApplicationPage>